<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Penta Square</title>
  <meta name="keywords" content="5x5 pixel art, 25 pixel art, minimal art project, pixel canvas, M5 Atom Matrix, M5Stack project, Arduino LED matrix, IoT art display, Scriptable iOS widget, JavaScript pixel app, creative coding, micro art, constrained design" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://penta-square.deno.dev/">
  <meta property="og:title" content="Penta Square">
  <meta property="og:description" content="Create, share, and explore 5x5 pixel art. Paint your own or upload images to generate patterns.">
  <meta property="og:image" content="/assets/penta-square-logo.png">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:title" content="Penta Square">
  <meta property="twitter:description" content="Create, share, and explore 5x5 pixel art. Paint your own or upload images to generate patterns.">
  <meta property="twitter:image" content="/assets/penta-square-logo.png">

  <style>
    :root {
      --bg-color: #f8f9fa;
      --card-bg: #ffffff;
      --text-primary: #2d3436;
      --text-secondary: #636e72;
      --accent-color: #0984e3;
      --border-radius: 12px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --transition: all 0.2s ease;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 2rem 1rem;
    }
    
    .app-container {
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
      max-width: 500px;
      width: 100%;
      margin-bottom: 3rem;
    }
    
    header {
      text-align: center;
    }
    
    h1 {
      margin: 0 0 0.5rem 0;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .matrix {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      background: #eee;
      border-radius: 4px;
      border: 1px solid #DDD;
    }
    
    .matrix div {
      width: 50px;
      height: 50px;
      background-color: #fff;
      cursor: pointer;
      transition: background-color 0.1s ease;
    }
    
    .matrix div:hover {
      opacity: 0.9;
      transform: scale(0.98);
    }
    
    .palette-container {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      width: 100%;
    }
    
    .palette-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-secondary);
      font-weight: 600;
      text-align: center;
    }
    
    .palette-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
    }
    
    .bucket {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: var(--transition);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .bucket:hover {
      transform: scale(1.1);
    }
    
    .bucket.selected {
      border-color: var(--text-primary);
      transform: scale(1.1);
    }
    
    .actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    button, .button-label {
      background: none;
      border: 1px solid #dfe6e9;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-secondary);
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      position: relative;
      overflow: hidden;
    }

    button svg, .button-label svg {
      width: 16px;
      height: 16px;
    }
    
    button:hover, .button-label:hover {
      background-color: #f1f2f6;
      color: var(--text-primary);
      border-color: #b2bec3;
    }
    
    button.primary {
      background-color: var(--text-primary);
      color: white;
      border-color: var(--text-primary);
    }
    
    button.primary:hover {
      background-color: #000;
      border-color: #000;
      color: white;
    }

    button.primary svg {
      stroke: white;
    }

    /* Dropdown Styles */
    .dropdown {
      position: relative;
      display: inline-block;
    }
    
    .dropdown-content {
      display: none;
      position: absolute;
      background: white;
      min-width: 120px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      z-index: 10;
      border-radius: 8px;
      bottom: calc(100% + 10px);
      left: 50%;
      transform: translateX(-50%);
      border: 1px solid #dfe6e9;
      overflow: hidden;
    }
    
    .dropdown-content div {
      padding: 0.75rem 1rem;
      cursor: pointer;
      font-size: 0.85rem;
      color: var(--text-secondary);
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .dropdown-content div:hover {
      background-color: #f1f2f6;
      color: var(--text-primary);
    }

    .dropdown-content div svg {
      width: 14px;
      height: 14px;
    }
    
    .show {
      display: block;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(-50%) translateY(10px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
    
    /* Gallery Styles */
    .gallery-container {
      width: 100%;
      max-width: 900px;
    }
    
    .gallery-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1.5rem;
    }
    
    .art-card {
      background: white;
      padding: 1rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      text-align: center;
      transition: var(--transition);
    }
    
    .art-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .art-preview:hover svg {
      border-color: var(--accent-color);
      transform: scale(1.02);
    }
    
    .art-card svg {
      width: 120px;
      height: 120px;
      border-radius: 4px;
      margin-bottom: 0.75rem;
      display: block;
      margin-left: auto;
      margin-right: auto;
      border: 1px solid #eee;
      transition: var(--transition);
    }
    
    .art-info h3 {
      margin: 0;
      font-size: 0.95rem;
      font-weight: 600;
    }
    
    .art-info p {
      margin: 0.2rem 0 0;
      font-size: 0.75rem;
    }
    
    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(2px);
    }
    
    .modal {
      background: white;
      padding: 2rem;
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 320px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    
    .modal h2 {
      margin-top: 0;
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }
    
    .form-group {
      margin-bottom: 1rem;
      text-align: left;
    }
    
    .form-group label {
      display: block;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
      color: var(--text-secondary);
    }
    
    .form-group input {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid #dfe6e9;
      border-radius: 6px;
      font-size: 0.9rem;
      box-sizing: border-box;
    }
    
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }
    
    #modal-form, #modal-loading, #modal-success {
      display: none;
    }
    
    #modal-loading {
      text-align: center;
      padding: 1rem 0;
    }
    
    .spinner {
      width: 30px;
      height: 30px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--accent-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .success-icon {
      color: #27ae60;
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    
    #modal-success { text-align: center; }
    
    @media (max-width: 600px) {
      .gallery-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
    }
    
  </style>
</head>
<body>
  
  <div class="app-container">
    <header>
      <h1>Penta Square</h1>
      <p>Select a color and paint pixels.</p>
    </header>
    
    <div class="matrix" id="grid"></div>
    
    <div class="palette-container">
      <div class="palette-label">Palette</div>
      <div class="palette-grid" id="palette"></div>
    </div>
    
    <div class="actions">
      <button onclick="resetGrid()" title="Clear the entire grid">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path></svg>
        Clear
      </button>
      
      <label class="button-label" title="Upload an image to parse colors">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
        Upload
        <input type="file" id="image-upload" accept="image/*" style="opacity: 0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;" onchange="handleImageUpload(event)">
      </label>

      <canvas id="parse-canvas" width="5" height="5" style="display: none;"></canvas>

      <div class="dropdown">
        <button onclick="toggleDownloadMenu()" title="Download art in various formats">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
          Download
        </button>
        <div id="download-menu" class="dropdown-content">
          <div onclick="downloadPNG()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
            PNG Image
          </div>
          <div onclick="downloadSVG()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            SVG Vector
          </div>
        </div>
      </div>

      <button class="primary" onclick="openSubmitModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
        Submit
      </button>
    </div>
  </div>
  
  <div class="gallery-container">
    <div class="gallery-header">
      <h2>Community Gallery</h2>
      <button onclick="fetchGallery()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
        Refresh
      </button>
    </div>
    <div class="gallery-grid" id="gallery">
      <!-- Art cards go here -->
    </div>
    <div style="margin-top: 2rem; text-align: center;" id="pagination-container">
      <button id="load-more" style="display: none;" onclick="fetchGallery(true)">Load More</button>
    </div>
  </div>
  
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div id="modal-form">
        <h2>Submit Your Art</h2>
        <div class="form-group">
          <label for="artName">Art Name</label>
          <input type="text" id="artName" placeholder="Give your art a name">
        </div>
        <div class="form-group">
          <label for="authorName">Your Name</label>
          <input type="text" id="authorName" placeholder="Who created this?">
        </div>
        <div class="modal-actions">
          <button onclick="closeModal()">Cancel</button>
          <button class="primary" onclick="processSubmission()">Send Art</button>
        </div>
      </div>
      
      <div id="modal-loading">
        <div class="spinner"></div>
        <p>Submitting your masterpiece...</p>
      </div>
      
      <div id="modal-success">
        <div class="success-icon">âœ“</div>
        <h2>Success!</h2>
        <p>Your art has been submitted.</p>
        <div class="modal-actions" style="justify-content: center;">
          <button class="primary" onclick="closeModal()">Awesome</button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    const ROWS = 5;
    const COLS = 5;
    let selectedColor = "#000000";
    let customColor = "#000000";
    let nextCursor = null;
    
    const colors = [
    "#f44336",
    "#e91e63",
    "#9c27b0",
    "#673ab7",
    "#3f51b5",
    "#2196f3",
    "#00bcd4",
    "#009688",
    "#4caf50",
    "#8bc34a",
    "#cddc39",
    "#ffeb3b",
    "#ff9800",
    "#795548",
    "#607d8b",
    "#ffffff",
    "#000000",
    ];
    
    let initialPattern = {
  "0": "#3526ff",
  "1": "#6627fb",
  "2": "#c01ed4",
  "3": "#ec1254",
  "4": "#f4122a",
  "5": "#3046fb",
  "6": "#713bf8",
  "7": "#c223d8",
  "8": "#e92360",
  "9": "#f53525",
  "10": "#17b8ef",
  "11": "#419cea",
  "12": "#9583c6",
  "13": "#e68843",
  "14": "#f78515",
  "15": "#12e5d2",
  "16": "#29e4b5",
  "17": "#98ec55",
  "18": "#eeea0d",
  "19": "#f8be12",
  "20": "#2af96c",
  "21": "#40fa57",
  "22": "#adfc1e",
  "23": "#f3fb08",
  "24": "#f3ef08"
};
    
    function init() {
      renderGrid();
      renderPalette();
      applyInitialPattern();
      fetchGallery();
    }
    
    function renderGrid() {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      for (let i = 0; i < ROWS * COLS; i++) {
        const cell = document.createElement('div');
        cell.id = `cell-${i}`;
        cell.addEventListener('click', () => paintCell(cell));
        cell.addEventListener('dblclick', () => resetCell(cell));
        grid.appendChild(cell);
      }
    }

    function resetCell(cell) {
      cell.style.backgroundColor = '';
      delete cell.dataset.color;
    }
    
    function renderPalette() {
      const palette = document.getElementById('palette');
      palette.innerHTML = '';
      colors.forEach(color => {
        const bucket = document.createElement('div');
        bucket.className = 'bucket';
        bucket.style.backgroundColor = color;
        if (color === '#FFFFFF') bucket.style.border = '1px solid #ddd';
        if (color === selectedColor) bucket.classList.add('selected');
        bucket.addEventListener('click', () => selectColor(color, bucket));
        palette.appendChild(bucket);
      });
      
      const customBucket = document.createElement('div');
      customBucket.className = 'bucket custom-bucket';
      customBucket.id = 'custom-bucket';
      customBucket.style.backgroundColor = customColor;
      customBucket.style.position = 'relative';
      customBucket.style.overflow = 'hidden';
      customBucket.innerHTML = `
        <span style="font-size: 18px; color: #fff; text-shadow: 0 0 2px #000; line-height: 32px; display: block; text-align: center; pointer-events: none;">+</span>
        <input type="color" id="custom-color-input" value="${customColor}" 
          style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; border: none; padding: 0;">
      `;
      palette.appendChild(customBucket);

      // Setup the event listener for the nested input
      const input = customBucket.querySelector('#custom-color-input');
      const handleColorChange = (e) => {
        customColor = e.target.value;
        customBucket.style.backgroundColor = customColor;
        selectColor(customColor, customBucket);
      };
      input.addEventListener('input', handleColorChange);
      input.addEventListener('change', handleColorChange);
    }
    
    function selectColor(color, element) {
      selectedColor = color;
      document.querySelectorAll('.bucket').forEach(b => b.classList.remove('selected'));
      element.classList.add('selected');
    }
    
    function paintCell(cell) {
      cell.style.backgroundColor = selectedColor;
      cell.dataset.color = selectedColor;
    }
    
    function applyInitialPattern() {
      for (const [index, color] of Object.entries(initialPattern)) {
        const cell = document.getElementById(`cell-${index}`);
        if (cell) {
          cell.style.backgroundColor = color;
          cell.dataset.color = color;
        }
      }
    }
    
    function resetGrid() {
      document.querySelectorAll('.matrix div').forEach(cell => {
        cell.style.backgroundColor = '';
        delete cell.dataset.color;
      });
    }

    function downloadSVG() {
      const mapping = {};
      for (let i = 0; i < ROWS * COLS; i++) {
        const color = document.getElementById(`cell-${i}`).dataset.color;
        if (color) mapping[i] = color;
      }
      const svgContent = generateArtSVG(mapping);
      const blob = new Blob([svgContent], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'penta-square-art.svg';
      link.click();
      URL.revokeObjectURL(url);
      document.getElementById('download-menu').classList.remove('show');
    }

    function downloadPNG() {
      const canvas = document.createElement('canvas');
      const size = 500; // 500x500 for good quality
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext('2d');
      const cellSize = size / 5;

      for (let i = 0; i < ROWS * COLS; i++) {
        const color = document.getElementById(`cell-${i}`).dataset.color || '#ffffff';
        const x = (i % 5) * cellSize;
        const y = Math.floor(i / 5) * cellSize;
        ctx.fillStyle = color;
        ctx.fillRect(x, y, cellSize, cellSize);
      }

      const link = document.createElement('a');
      link.download = 'penta-square-art.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
      document.getElementById('download-menu').classList.remove('show');
    }

    function toggleDownloadMenu() {
      document.getElementById('download-menu').classList.toggle('show');
    }

    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.getElementById("parse-canvas");
          const ctx = canvas.getContext("2d");
          
          // Draw image scaled to 5x5
          ctx.clearRect(0, 0, 5, 5);
          ctx.drawImage(img, 0, 0, 5, 5);

          const imageData = ctx.getImageData(0, 0, 5, 5).data;
          const mapping = {};

          for (let i = 0; i < 25; i++) {
            const index = i * 4;
            const r = imageData[index];
            const g = imageData[index + 1];
            const b = imageData[index + 2];
            const a = imageData[index + 3];

            // Only map if not fully transparent
            if (a > 0) {
              const hex = "#" + 
                r.toString(16).padStart(2, "0") + 
                g.toString(16).padStart(2, "0") + 
                b.toString(16).padStart(2, "0");
              mapping[i] = hex;
            }
          }

          loadArtIntoEditor(mapping);
          // Reset file input for same-file re-uploads
          event.target.value = '';
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    // Close dropdown when clicking outside
    window.addEventListener('click', (event) => {
      if (!event.target.closest('.dropdown')) {
        const menu = document.getElementById('download-menu');
        if (menu && menu.classList.contains('show')) {
          menu.classList.remove('show');
        }
      }
    });

    function loadArtIntoEditor(mapping) {
      resetGrid();
      for (const [index, color] of Object.entries(mapping)) {
        const cell = document.getElementById(`cell-${index}`);
        if (cell) {
          cell.style.backgroundColor = color;
          cell.dataset.color = color;
        }
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    function openSubmitModal() {
      const savedAuthor = localStorage.getItem('penta-square-author');
      if (savedAuthor) {
        document.getElementById('authorName').value = savedAuthor;
      }
      document.getElementById('modalOverlay').style.display = 'flex';
      showModalState('form');
    }
    
    function closeModal() {
      document.getElementById('modalOverlay').style.display = 'none';
    }
    
    function showModalState(state) {
      document.getElementById('modal-form').style.display = state === 'form' ? 'block' : 'none';
      document.getElementById('modal-loading').style.display = state === 'loading' ? 'block' : 'none';
      document.getElementById('modal-success').style.display = state === 'success' ? 'block' : 'none';
    }
    
    async function processSubmission() {
      const artName = document.getElementById('artName').value.trim();
      const authorName = document.getElementById('authorName').value.trim();
      if (!artName || !authorName) return alert("Both fields are required!");
      
      showModalState('loading');
      
      // Store author name for next time
      localStorage.setItem('penta-square-author', authorName);
      
      const mapping = {};
      for (let i = 0; i < ROWS * COLS; i++) {
        const color = document.getElementById(`cell-${i}`).dataset.color;
        if (color) mapping[i] = color;
      }
      
      try {
        const response = await fetch('/api/art', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name: artName, author: authorName, mapping })
        });
        if (response.ok) {
          showModalState('success');
          fetchGallery(); // Refresh gallery
        } else {
          showModalState('form');
        }
      } catch (e) {
        showModalState('form');
      }
    }
    
    async function fetchGallery(loadMore = false) {
      const gallery = document.getElementById('gallery');
      const loadMoreBtn = document.getElementById('load-more');
      
      if (!loadMore) {
        gallery.innerHTML = '<p>Loading gallery...</p>';
        nextCursor = null;
      }
      
      const url = `/api/art?limit=20${nextCursor ? `&cursor=${nextCursor}` : ''}`;
      
      try {
        const response = await fetch(url);
        const result = await response.json();
        
        if (!loadMore) gallery.innerHTML = '';
        
        result.data.forEach(art => {
          const card = document.createElement('div');
          card.className = 'art-card';
          card.innerHTML = `
            <div class="art-preview" style="cursor: pointer;" title="Click to load into editor">
              ${generateArtSVG(art.mapping)}
            </div>
            <div class="art-info">
              <h3>${escapeHtml(art.name)}</h3>
              <p>by ${escapeHtml(art.author)}</p>
            </div>
          `;
          
          card.querySelector('.art-preview').addEventListener('click', () => {
            loadArtIntoEditor(art.mapping);
          });
          
          gallery.appendChild(card);
        });
        
        nextCursor = result.next_cursor;
        loadMoreBtn.style.display = nextCursor ? 'inline-block' : 'none';
        
        if (result.data.length === 0 && !loadMore) {
          gallery.innerHTML = '<p>No art submitted yet. Be the first!</p>';
        }
      } catch (e) {
        gallery.innerHTML = '<p>Failed to load gallery.</p>';
      }
    }
    
    function generateArtSVG(mapping) {
      let rects = '';
      for (let i = 0; i < 25; i++) {
        const color = mapping[i] || '#ffffff';
        const x = (i % 5) * 20;
        const y = Math.floor(i / 5) * 20;
        rects += `<rect x="${x}" y="${y}" width="20" height="20" fill="${color}" />`;
      }
      return `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">${rects}</svg>`;
    }
    
    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }
    
    init();
  </script>
</body>
</html>